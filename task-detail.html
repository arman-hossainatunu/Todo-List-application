<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
    <!-- Header -->
    <header class="mb-6 text-center">
      <h1 class="text-4xl font-bold text-purple-700">üìã Task Details</h1>
      <p class="text-gray-600 mt-1">All your tasks are listed below.</p>
    </header>

    <!-- Tomorrow alert -->
    <div
      id="alertIcon"
      class="hidden mt-4 text-center text-red-500 text-lg font-bold"
    >
      ‚ö†Ô∏è You have <span id="tomorrowCount">0</span> task(s) scheduled for
      tomorrow!
    </div>

    <!-- Card List Grid -->
    <div
      id="cardList"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6 w-full max-w-full"
    ></div>
    <div>
      <!-- Go Back Button -->
      <button
        onclick="goBack()"
        class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
      >
        ‚¨ÖÔ∏è Go Back
      </button>
      <!-- Show More Button -->
      <button
        id="showMoreBtn"
        class="mt-4 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition hidden"
      >
        Show More ‚¨áÔ∏è
      </button>
    </div>

    <script>
      let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
      const cardList = document.getElementById("cardList");
      const alertIcon = document.getElementById("alertIcon");
      const tomorrowCountSpan = document.getElementById("tomorrowCount");
      const showMoreBtn = document.getElementById("showMoreBtn");

      const INITIAL_DISPLAY = 6; // Number of cards to show initially
      let cardsDisplayed = 0;

      // Format date to DD/MM/YYYY
      function formatDateDDMMYYYY(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      // Check if a date is tomorrow
      function isTomorrow(dateString) {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        const taskDate = new Date(dateString);
        return taskDate.toDateString() === tomorrow.toDateString();
      }

      // Update tomorrow alert
      function updateTomorrowAlert() {
        const tomorrowTasks = tasks.filter((task) =>
          isTomorrow(task.targetDate)
        );
        const count = tomorrowTasks.length;
        if (count > 0) {
          tomorrowCountSpan.textContent = count;
          alertIcon.classList.remove("hidden");
        } else {
          alertIcon.classList.add("hidden");
        }
      }

      // Render cards with pagination
      function renderCards() {
        // Sort tasks by targetDate
        tasks.sort((a, b) => new Date(a.targetDate) - new Date(b.targetDate));

        cardList.innerHTML = "";
        cardsDisplayed = Math.min(INITIAL_DISPLAY, tasks.length);

        for (let i = 0; i < cardsDisplayed; i++) {
          cardList.appendChild(createCardElement(tasks[i], i));
        }

        // Show or hide "Show More" button
        if (tasks.length > INITIAL_DISPLAY) {
          showMoreBtn.classList.remove("hidden");
        } else {
          showMoreBtn.classList.add("hidden");
        }
      }

      function createCardElement(task, index) {
        const card = document.createElement("div");
        card.className =
          "bg-white shadow-lg rounded-2xl p-4 flex flex-col gap-2 cursor-pointer hover:shadow-xl transition";

        card.innerHTML = `
        <h3 class="text-xl font-semibold ${
          task.completed ? "line-through text-gray-400" : "text-gray-800"
        }">
          ${task.text}
        </h3>
        <p class="text-gray-500"><strong>Created:</strong> ${formatDateDDMMYYYY(
          task.date
        )}</p>
        <p class="text-purple-600"><strong>Target Date:</strong> ${formatDateDDMMYYYY(
          task.targetDate
        )}</p>
        <div class="flex justify-between mt-2">
          <button class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition"
            onclick="completeTask(${index}); event.stopPropagation();">
            Complete ‚úÖ
          </button>
          <button class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition"
            onclick="deleteTask(${index}); event.stopPropagation();">
            Delete ‚ùå
          </button>
        </div>
      `;
        return card;
      }

      // Show more cards
      showMoreBtn.addEventListener("click", () => {
        const remaining = tasks.length - cardsDisplayed;
        const nextDisplay = Math.min(
          cardsDisplayed + INITIAL_DISPLAY,
          tasks.length
        );

        for (let i = cardsDisplayed; i < nextDisplay; i++) {
          cardList.appendChild(createCardElement(tasks[i], i));
        }

        cardsDisplayed = nextDisplay;

        if (cardsDisplayed >= tasks.length) {
          showMoreBtn.classList.add("hidden");
        }
      });

      function completeTask(index) {
        tasks[index].completed = true;
        tasks.splice(index, 1); // remove completed
        localStorage.setItem("tasks", JSON.stringify(tasks));
        renderCards();
        updateTomorrowAlert();
      }

      function deleteTask(index) {
        tasks.splice(index, 1);
        localStorage.setItem("tasks", JSON.stringify(tasks));
        renderCards();
        updateTomorrowAlert();
      }

      function goBack() {
        window.location.href = "index.html";
      }

      // Initial render
      renderCards();
      updateTomorrowAlert();
    </script>
  </body>
</html>
